{% extends "admin/base.html" %}

{% block title %}Settings{% endblock %}

{% block content %}
<script type="application/json" id="settings-data">{{ settings_json|safe }}</script>

<div x-data="settingsPage(JSON.parse(document.getElementById('settings-data').textContent || '{}'))" x-init="init()"
    class="space-y-8 max-w-5xl mx-auto">

    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Settings</h1>
            <p class="text-gray-600 dark:text-gray-400 mt-1">Manage your store preferences and integrations.</p>
        </div>
        <button type="submit" form="settings-form"
            class="inline-flex items-center px-6 py-2.5 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 shadow-sm transition-all">
            <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Save Changes
        </button>
    </div>

    <form id="settings-form" method="POST" action="{{ url_for('admin.manage_settings') }}" enctype="multipart/form-data"
        class="space-y-8">

        <!-- Tabs -->
        <div class="border-b border-gray-200 dark:border-gray-700">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <button @click.prevent="mainTab = 'storeProfile'"
                    :class="mainTab === 'storeProfile' ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'"
                    class="group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                    <svg :class="mainTab === 'storeProfile' ? 'text-indigo-500 dark:text-indigo-400' : 'text-gray-400 group-hover:text-gray-500'"
                        class="-ml-0.5 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                    Store Profile
                </button>
                <button @click.prevent="mainTab = 'appearance'"
                    :class="mainTab === 'appearance' ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'"
                    class="group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                    <svg :class="mainTab === 'appearance' ? 'text-indigo-500 dark:text-indigo-400' : 'text-gray-400 group-hover:text-gray-500'"
                        class="-ml-0.5 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                    </svg>
                    Appearance
                </button>
                <button @click.prevent="mainTab = 'integrations'"
                    :class="mainTab === 'integrations' ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'"
                    class="group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                    <svg :class="mainTab === 'integrations' ? 'text-indigo-500 dark:text-indigo-400' : 'text-gray-400 group-hover:text-gray-500'"
                        class="-ml-0.5 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z" />
                    </svg>
                    Integrations
                </button>
            </nav>
        </div>

        <!-- Store Profile Section -->
        <div x-show="mainTab === 'storeProfile'" x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0"
            class="space-y-6">

            <!-- Public Profile Toggle -->
            <div class="bg-white dark:bg-gray-800 shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 p-6 flex flex-col md:flex-row md:items-center justify-between gap-4 transition-all duration-200"
                :class="settings.store_profile_enabled ? 'ring-1 ring-indigo-500 border-indigo-500' : ''">
                <div class="flex items-center gap-4">
                    <div class="p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-full shrink-0">
                        <svg class="w-6 h-6 text-indigo-600 dark:text-indigo-400" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white">Public Profile</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Show a dedicated bio section at the top of
                            your store.</p>
                    </div>
                </div>
                <button type="button"
                    class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                    :class="settings.store_profile_enabled ? 'bg-indigo-600' : 'bg-gray-200 dark:bg-gray-700'"
                    role="switch" aria-checked="false"
                    @click="settings.store_profile_enabled = !settings.store_profile_enabled">
                    <input type="checkbox" name="store_profile_enabled" class="hidden"
                        x-model="settings.store_profile_enabled">
                    <span
                        class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                        :class="settings.store_profile_enabled ? 'translate-x-5' : 'translate-x-0'"></span>
                </button>
            </div>

            <div x-show="settings.store_profile_enabled" x-collapse>
                <div
                    class="bg-white dark:bg-gray-800 shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 p-6 md:p-8 space-y-8">

                    <!-- Profile Header Info -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Profile Details</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                            <!-- Left Column: Photo & Basic Info -->
                            <div class="space-y-6">
                                <!-- Profile Photo -->
                                <div>
                                    <label
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Profile
                                        Photo</label>
                                    <div class="flex items-center gap-6">
                                        <div class="relative group">
                                            <div
                                                class="h-24 w-24 rounded-full overflow-hidden bg-gray-100 dark:bg-gray-700 border-2 border-white dark:border-gray-600 shadow-md">
                                                <template x-if="settings.store_photo_url">
                                                    <img :src="settings.store_photo_url" alt="Profile"
                                                        class="h-full w-full object-cover">
                                                </template>
                                                <template x-if="!settings.store_photo_url">
                                                    <div
                                                        class="h-full w-full flex items-center justify-center text-gray-400">
                                                        <svg class="h-10 w-10" fill="currentColor" viewBox="0 0 24 24">
                                                            <path
                                                                d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                                                        </svg>
                                                    </div>
                                                </template>
                                            </div>
                                            <input type="file" name="store_photo" id="store_photo"
                                                class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                                accept="image/*">
                                        </div>
                                        <div class="text-sm text-gray-500">
                                            <p>Recommended: Square JPG, PNG.</p>
                                            <p>200x200px or larger.</p>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label for="store_name"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Display
                                        Name / Store Name</label>
                                    <input type="text" id="store_name" name="store_name" :value="settings.store_name"
                                        class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm h-10 px-3">
                                </div>

                                <div>
                                    <label for="store_signature"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Signature
                                        / Tagline</label>
                                    <input type="text" id="store_signature" name="store_signature"
                                        :value="settings.store_signature" placeholder="e.g. Creating with passion ✨"
                                        class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm h-10 px-3">
                                </div>
                            </div>

                            <!-- Right Column: Bio & Socials -->
                            <div class="space-y-6">
                                <div>
                                    <label for="store_bio_long"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">About
                                        You (Extended)</label>
                                    <textarea id="store_bio_long" name="store_bio_long" rows="5"
                                        placeholder="Tell your story! Keep it fun and engaging."
                                        class="form-textarea block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3"
                                        x-text="settings.store_bio_long"></textarea>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label
                                            class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Instagram
                                            URL</label>
                                        <input type="text" name="social_instagram" :value="settings.social_instagram"
                                            placeholder="https://instagram.com/..."
                                            class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-xs h-9 px-3">
                                    </div>
                                    <div>
                                        <label
                                            class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Twitter
                                            / X URL</label>
                                        <input type="text" name="social_twitter" :value="settings.social_twitter"
                                            placeholder="https://x.com/..."
                                            class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-xs h-9 px-3">
                                    </div>
                                    <div>
                                        <label
                                            class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">TikTok
                                            URL</label>
                                        <input type="text" name="social_tiktok" :value="settings.social_tiktok"
                                            placeholder="https://tiktok.com/@..."
                                            class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-xs h-9 px-3">
                                    </div>
                                    <div>
                                        <label
                                            class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">YouTube
                                            URL</label>
                                        <input type="text" name="social_youtube" :value="settings.social_youtube"
                                            placeholder="https://youtube.com/..."
                                            class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-xs h-9 px-3">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SEO Settings (Collapsed by default if Profile is enabled to save space, or kept as secondary) -->
            <div
                class="bg-white dark:bg-gray-800 shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 p-6 md:p-8">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">SEO & Metadata</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <label for="store_handle"
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Store
                            Handle</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <span
                                class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-500 sm:text-sm">
                                nyota.store/
                            </span>
                            <input type="text" id="store_handle" name="store_handle" :value="settings.store_handle"
                                class="flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-r-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm h-10">
                        </div>
                    </div>
                    <div>
                        <label for="store_bio"
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Meta
                            Description</label>
                        <textarea id="store_bio" name="store_bio" rows="3"
                            class="form-textarea block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3"
                            x-text="settings.store_bio"></textarea>
                        <p class="mt-1.5 text-xs text-gray-500">Brief description of your store for search engines.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Appearance Section -->
        <div x-show="mainTab === 'appearance'" x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0"
            x-cloak class="space-y-6">

            <div
                class="bg-white dark:bg-gray-800 shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 p-6 md:p-8">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Admin Panel Theme</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Choose how your admin dashboard looks.</p>

                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 xl:gap-6">
                    <!-- Light -->
                    <button type="button" @click="setTheme('light')"
                        class="relative group rounded-xl border p-4 flex items-center gap-4 text-left transition-all hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none"
                        :class="theme === 'light' ? 'bg-indigo-50 border-indigo-200 ring-1 ring-indigo-500 dark:bg-indigo-900/10 dark:border-indigo-500/50' : 'bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700'">
                        <div
                            class="h-10 w-10 shrink-0 bg-white border border-gray-200 rounded-full flex items-center justify-center shadow-sm">
                            <svg class="w-6 h-6 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                            </svg>
                        </div>
                        <div>
                            <span class="block font-medium text-gray-900 dark:text-white">Light Mode</span>
                        </div>
                        <div x-show="theme === 'light'"
                            class="absolute -top-2 -right-2 bg-indigo-500 rounded-full p-0.5 border-2 border-white dark:border-gray-800">
                            <svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4"
                                    d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                    </button>

                    <!-- Dark -->
                    <button type="button" @click="setTheme('dark')"
                        class="relative group rounded-xl border p-4 flex items-center gap-4 text-left transition-all hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none"
                        :class="theme === 'dark' ? 'bg-indigo-50 border-indigo-200 ring-1 ring-indigo-500 dark:bg-indigo-900/10 dark:border-indigo-500/50' : 'bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700'">
                        <div
                            class="h-10 w-10 shrink-0 bg-gray-900 border border-gray-700 rounded-full flex items-center justify-center shadow-sm">
                            <svg class="w-5 h-5 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                            </svg>
                        </div>
                        <div>
                            <span class="block font-medium text-gray-900 dark:text-white">Dark Mode</span>
                        </div>
                        <div x-show="theme === 'dark'"
                            class="absolute -top-2 -right-2 bg-indigo-500 rounded-full p-0.5 border-2 border-white dark:border-gray-800">
                            <svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4"
                                    d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                    </button>

                    <!-- System -->
                    <button type="button" @click="setTheme('system')"
                        class="relative group rounded-xl border p-4 flex items-center gap-4 text-left transition-all hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none"
                        :class="theme === 'system' ? 'bg-indigo-50 border-indigo-200 ring-1 ring-indigo-500 dark:bg-indigo-900/10 dark:border-indigo-500/50' : 'bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700'">
                        <div
                            class="h-10 w-10 shrink-0 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 border border-gray-300 dark:border-gray-600 rounded-full flex items-center justify-center shadow-sm">
                            <svg class="w-6 h-6 text-gray-600 dark:text-gray-300" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <div>
                            <span class="block font-medium text-gray-900 dark:text-white">System</span>
                        </div>
                        <div x-show="theme === 'system'"
                            class="absolute -top-2 -right-2 bg-indigo-500 rounded-full p-0.5 border-2 border-white dark:border-gray-800">
                            <svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4"
                                    d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Integrations Section -->
        <div x-show="mainTab === 'integrations'" x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0"
            x-cloak class="grid grid-cols-1 lg:grid-cols-12 gap-6">

            <!-- Sidebar Navigation for Integrations -->
            <div class="lg:col-span-3">
                <nav class="space-y-1">
                    <button @click.prevent="integrationTab = 'notifications'"
                        :class="integrationTab === 'notifications' ? 'bg-indigo-50 text-indigo-700 dark:bg-indigo-900/20 dark:text-indigo-300' : 'text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-800'"
                        class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors">
                        <span class="truncate">Notifications</span>
                    </button>
                    <button @click.prevent="integrationTab = 'payments'"
                        :class="integrationTab === 'payments' ? 'bg-indigo-50 text-indigo-700 dark:bg-indigo-900/20 dark:text-indigo-300' : 'text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-800'"
                        class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors">
                        <span class="truncate">Payments</span>
                    </button>
                </nav>
            </div>

            <!-- Integrations Content -->
            <div class="lg:col-span-9 space-y-6">

                <!-- Notifications Tab -->
                <div x-show="integrationTab === 'notifications'" class="space-y-6">
                    <!-- Telegram -->
                    <div class="bg-white dark:bg-gray-800 shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 p-6 transition-all duration-200"
                        :class="telegramEnabled ? 'ring-1 ring-indigo-500 border-indigo-500' : ''">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                    <svg class="w-6 h-6 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                                        <path
                                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.06-.14-.09-.21-.09-.09 0-1.51.96-4.27 2.83-.4.27-.76.41-1.08.4-.36-.01-1.06-.2-1.58-.37-.63-.22-1.13-.34-1.08-.72.02-.19.29-.39.79-.59 3.1-1.35 5.17-2.23 6.21-2.66 2.95-1.23 3.56-1.44 3.97-1.45.09 0 .28.02.41.11.12.09.15.21.16.29.01.07.01.19 0 .22z" />
                                    </svg>
                                </div>
                                <h3 class="text-base font-semibold text-gray-900 dark:text-white">Telegram</h3>
                            </div>
                            <!-- Switch -->
                            <button type="button"
                                class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                                :class="telegramEnabled ? 'bg-indigo-600' : 'bg-gray-200 dark:bg-gray-700'"
                                role="switch" aria-checked="false" @click="telegramEnabled = !telegramEnabled">
                                <input type="checkbox" name="telegram_enabled" class="hidden" x-model="telegramEnabled">
                                <span
                                    class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                                    :class="telegramEnabled ? 'translate-x-5' : 'translate-x-0'"></span>
                            </button>
                        </div>

                        <div x-show="telegramEnabled" x-collapse
                            class="mt-6 border-t border-gray-100 dark:border-gray-700 pt-6 space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Bot
                                        Token</label>
                                    <input type="password" name="telegram_bot_token"
                                        :value="settings.telegram_bot_token"
                                        class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm h-10 px-3">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Chat
                                        ID</label>
                                    <input type="text" name="telegram_chat_id" :value="settings.telegram_chat_id"
                                        class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm h-10 px-3">
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <button type="button" @click="testTelegram()" :disabled="telegramTesting"
                                    class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-lg text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    <span x-show="!telegramTesting">Test Connection</span>
                                    <span x-show="telegramTesting">Testing...</span>
                                </button>
                                <span x-show="telegramTested" x-transition
                                    :class="telegramTestSuccess ? 'text-green-600' : 'text-red-500'"
                                    class="text-sm font-medium">
                                    <span
                                        x-text="telegramTestSuccess ? '✓ Connected successfully' : '✗ Connection failed'"></span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- SMTP -->
                    <div class="bg-white dark:bg-gray-800 shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 p-6 transition-all duration-200"
                        :class="smtpEnabled ? 'ring-1 ring-indigo-500 border-indigo-500' : ''">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                    <svg class="w-6 h-6 text-purple-500" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                    </svg>
                                </div>
                                <h3 class="text-base font-semibold text-gray-900 dark:text-white">Email (SMTP)</h3>
                            </div>
                            <button type="button"
                                class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                                :class="smtpEnabled ? 'bg-indigo-600' : 'bg-gray-200 dark:bg-gray-700'" role="switch"
                                aria-checked="false" @click="smtpEnabled = !smtpEnabled">
                                <input type="checkbox" name="email_smtp_enabled" class="hidden" x-model="smtpEnabled">
                                <span
                                    class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                                    :class="smtpEnabled ? 'translate-x-5' : 'translate-x-0'"></span>
                            </button>
                        </div>

                        <div x-show="smtpEnabled" x-collapse
                            class="mt-6 border-t border-gray-100 dark:border-gray-700 pt-6 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">SMTP
                                    Host</label>
                                <input type="text" name="smtp_host" :value="settings.smtp_host"
                                    class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm h-10 px-3">
                            </div>
                            <div class="flex items-end gap-3">
                                <div class="flex-1">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Test
                                        Email Recipient</label>
                                    <input type="email" x-model="testEmailAddress" placeholder="you@example.com"
                                        class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm h-10 px-3">
                                </div>
                                <button type="button" @click="testEmail()" :disabled="emailTesting"
                                    class="h-10 inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-lg text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    <span x-show="!emailTesting">Send Test</span>
                                    <span x-show="emailTesting">Sending...</span>
                                </button>
                            </div>
                            <p x-show="emailTested" x-transition
                                :class="emailTestSuccess ? 'text-green-600' : 'text-red-500'"
                                class="text-sm font-medium mt-2">
                                <span
                                    x-text="emailTestSuccess ? '✓ Email sent successfully' : '✗ Failed to send email'"></span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Payments Tab -->
                <div x-show="integrationTab === 'payments'" class="space-y-6">
                    <div class="bg-white dark:bg-gray-800 shadow-sm rounded-xl border border-gray-200 dark:border-gray-700 p-6 transition-all duration-200 border-l-4"
                        :class="settings.payment_uza_enabled ? 'border-l-indigo-500' : 'border-l-transparent'">

                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <svg class="w-6 h-6 text-green-600" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-base font-semibold text-gray-900 dark:text-white">UZA Payments</h3>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">Primary payment gateway</p>
                                </div>
                            </div>
                            <button type="button"
                                class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                                :class="settings.payment_uza_enabled ? 'bg-indigo-600' : 'bg-gray-200 dark:bg-gray-700'"
                                role="switch" aria-checked="false"
                                @click="settings.payment_uza_enabled = !settings.payment_uza_enabled">
                                <input type="checkbox" name="payment_uza_enabled" class="hidden"
                                    x-model="settings.payment_uza_enabled">
                                <span
                                    class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                                    :class="settings.payment_uza_enabled ? 'translate-x-5' : 'translate-x-0'"></span>
                            </button>
                        </div>

                        <div class="grid grid-cols-1 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Public
                                    Key (PK)</label>
                                <textarea name="payment_uza_pk" rows="2"
                                    class="form-textarea block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-xs font-mono p-3"
                                    x-text="settings.payment_uza_pk"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Callback
                                    Secret</label>
                                <input type="password" name="payment_uza_secret" :value="settings.payment_uza_secret"
                                    class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono h-10 px-3">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Reference
                                        Code</label>
                                    <input type="text" name="payment_uza_refcode" :value="settings.payment_uza_refcode"
                                        class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm h-10 px-3">
                                </div>
                                <div>
                                    <label
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Source
                                        Tag</label>
                                    <input type="text" name="payment_uza_source" :value="settings.payment_uza_source"
                                        class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm h-10 px-3">
                                </div>
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Currency</label>
                                <input type="text" name="payment_uza_currency" :value="settings.payment_uza_currency"
                                    class="form-input block w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700/50 text-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm h-10 px-3 uppercase w-24">
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>

    </form>
</div>
{% endblock %}

{% block scripts_extra %}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}